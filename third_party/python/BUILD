licenses(["notice"])

package(default_visibility = ["//visibility:public"])

package_name = "Python"
package_version = "2.7.12"

package_file = package_name + "-" + package_version + ".tgz"
package_dir = package_name + "-" + package_version

BIN_FILES = [
    "bin/2to3",
    "bin/idle",
    "bin/pydoc",
    "bin/python",
    "bin/python2",
    "bin/python2.7",
    "bin/python2.7-config",
    "bin/python2-config",
    "bin/python-config",
    "bin/smtpd.py",
]

LIB_FILES = [
    "lib/libpython2.7.a",
]

H_SRCS = [
    "include/python2.7/iterobject.h",
    "include/python2.7/pgenheaders.h",
    "include/python2.7/graminit.h",
    "include/python2.7/bytesobject.h",
    "include/python2.7/intrcheck.h",
    "include/python2.7/datetime.h",
    "include/python2.7/patchlevel.h",
    "include/python2.7/cobject.h",
    "include/python2.7/osdefs.h",
    "include/python2.7/Python.h",
    "include/python2.7/dtoa.h",
    "include/python2.7/pygetopt.h",
    "include/python2.7/Python-ast.h",
    "include/python2.7/pyexpat.h",
    "include/python2.7/pyarena.h",
    "include/python2.7/bufferobject.h",
    "include/python2.7/pythonrun.h",
    "include/python2.7/cellobject.h",
    "include/python2.7/tupleobject.h",
    "include/python2.7/pymacconfig.h",
    "include/python2.7/bitset.h",
    "include/python2.7/pyport.h",
    "include/python2.7/pycapsule.h",
    "include/python2.7/pystate.h",
    "include/python2.7/classobject.h",
    "include/python2.7/longobject.h",
    "include/python2.7/pyerrors.h",
    "include/python2.7/ceval.h",
    "include/python2.7/symtable.h",
    "include/python2.7/intobject.h",
    "include/python2.7/pymactoolbox.h",
    "include/python2.7/token.h",
    "include/python2.7/traceback.h",
    "include/python2.7/setobject.h",
    "include/python2.7/bytearrayobject.h",
    "include/python2.7/pymem.h",
    "include/python2.7/import.h",
    "include/python2.7/pythread.h",
    "include/python2.7/pydebug.h",
    "include/python2.7/marshal.h",
    "include/python2.7/object.h",
    "include/python2.7/unicodeobject.h",
    "include/python2.7/methodobject.h",
    "include/python2.7/parsetok.h",
    "include/python2.7/moduleobject.h",
    "include/python2.7/eval.h",
    "include/python2.7/compile.h",
    "include/python2.7/modsupport.h",
    "include/python2.7/timefuncs.h",
    "include/python2.7/pystrtod.h",
    "include/python2.7/node.h",
    "include/python2.7/warnings.h",
    "include/python2.7/errcode.h",
    "include/python2.7/ucnhash.h",
    "include/python2.7/asdl.h",
    "include/python2.7/pystrcmp.h",
    "include/python2.7/weakrefobject.h",
    "include/python2.7/pgen.h",
    "include/python2.7/floatobject.h",
    "include/python2.7/rangeobject.h",
    "include/python2.7/listobject.h",
    "include/python2.7/structmember.h",
    "include/python2.7/structseq.h",
    "include/python2.7/py_curses.h",
    "include/python2.7/pyfpe.h",
    "include/python2.7/objimpl.h",
    "include/python2.7/codecs.h",
    "include/python2.7/abstract.h",
    "include/python2.7/fileobject.h",
    "include/python2.7/boolobject.h",
    "include/python2.7/frameobject.h",
    "include/python2.7/sliceobject.h",
    "include/python2.7/pymath.h",
    "include/python2.7/bytes_methods.h",
    "include/python2.7/ast.h",
    "include/python2.7/code.h",
    "include/python2.7/metagrammar.h",
    "include/python2.7/descrobject.h",
    "include/python2.7/cStringIO.h",
    "include/python2.7/complexobject.h",
    "include/python2.7/memoryobject.h",
    "include/python2.7/opcode.h",
    "include/python2.7/sysmodule.h",
    "include/python2.7/pyconfig.h",
    "include/python2.7/grammar.h",
    "include/python2.7/longintrepr.h",
    "include/python2.7/stringobject.h",
    "include/python2.7/funcobject.h",
    "include/python2.7/genobject.h",
    "include/python2.7/pyctype.h",
    "include/python2.7/enumobject.h",
    "include/python2.7/dictobject.h",
]

genrule(
    name = "python-srcs",
    srcs = [
        package_file, 
    ],
    outs = BIN_FILES + LIB_FILES + H_SRCS,
    cmd = "\n".join([
        "export INSTALL_DIR=$$(pwd)/$(@D)",
        "export TMP_DIR=$$(mktemp -d -t Python.XXXXX)",
        "mkdir -p $$TMP_DIR",
        "cp -R $(SRCS) $$TMP_DIR",
        "cd $$TMP_DIR",
        "tar xfz " + package_file,
        "cd " + package_dir,
        "./configure --prefix=$$INSTALL_DIR --enable-shared=no",
        "make install",
        "rm -rf $$TMP_DIR",
    ]),
)

cc_library(
    name = "python-cxx",
    srcs = LIB_FILES, 
    hdrs = H_SRCS, 
    includes = [ 
        "include/python2.7",
    ],  
    linkstatic = 1,
)
